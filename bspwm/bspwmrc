#! /bin/sh

# Wait until XFCE settings daemon is initialized
until p=$(pidof xfsettingsd)
do
	sleep 1
done

xmodmap ~/.config/X11/.Xmodmap

pgrep -x sxhkd > /dev/null || sxhkd &
$HOME/.config/polybar/launch.sh &
bspwm &

# Monitors
monitors=( $(xrandr | awk '$2 == "connected"{print $1}') )
num_monitors=${#monitors[@]}

# Flush monitors when before restarting
bspc config remove_unplugged_monitors true

if [ $num_monitors -eq 1 ]
then
	bspc monitor eDP -d I II III IV V VI VII VIII IX
else
	bspc monitor eDP -d I II
	bspc monitor HDMI-A-0 -d III IV V VI VII VIII IX

	# TEMPORARY BUG FX: Reset monitor padding after sleep
	bspc config -m HDMI-A-0 right_padding 0
	bspc config -m HDMI-A-0 bottom_padding 0

	bspc wm -O eDP HDMI-A-0
fi

# Border
bspc config border_width 3
bspc config focused_border_color "#fca503"

# Gap
bspc config window_gap 10
bspc config top_padding 10

bspc config pointer_follows_focus true

bspc config split_ratio          0.50
bspc config borderless_monocle   false
bspc config gapless_monocle      true
bspc config top_monocle_padding  -5

bspc rule -a Brave-browser desktop='^4' focus=on
bspc rule -a mplayer2 state=floating
bspc rule -a Kupfer.py focus=on
bspc rule -a Screenkey manage=off
bspc rule -a plasma.emojier state=floating
